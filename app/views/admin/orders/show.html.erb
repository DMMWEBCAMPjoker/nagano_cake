<h3>注文履歴詳細</h3>

<p>購入者</p>
<%= link_to admin_customer_path(@order.customer), do %>
  <%= @order.customer.full_name %>
<% end %>

<p>注文日</p>
<%= @order.created_at.strftime("%Y/%m/%d ") %>

<p>配送先</p>
〒<%= @order.delivery_postcode.to_s %>
<%= @order.delivery_address %>
<%= @order.delivery_name %>

<p>支払方法</p>
<%= @order.payment_method %>

<p>注文ステータス</p>
<%= form_with model: @order, url: admin_order_path, method: :patch do |f| %>
  <%= f.select :status[["入金待ち","waiting_payment"],
                       ["入金確認","paymet_confirmation"],
                       ["製作中","in_production"],
                       ["発送準備中","preparing_delivery"],
                       ["発送済み","delivered"]] %>
  <%= f.submit "更新", class: 'btn btn-success' %>
<% end %>

<table>
  <thead>
    <tr>
      <th>商品名</th>
      <th>単価(税込)</th>
      <th>数量</th>
      <th>小計</th>
      <th>製作ステータス</th>
    </tr>
  </thead>
  <% @order.order_items.each do |item| %>
  <tbody>
    <tr>
      <td><%= item.item.name %></td>
      <td><%= item.tax_item_price %></td>
      <td><%= item.item_quantity %></td>
      <td><%= item.subtotal %></td>
      <td>
        <%= form_with model: item, url: admin_order_item_path(item), method: :patch do |f| %>
          <%= f.hidden_field :marking_status,[["着手不可","no_production"],
                                              ["製作待ち","waiting_production"],
                                              ["製作中","in_production"],
                                              ["製作完了","completion_production"]] %>
          <%= f.hidden_field :order_id ,:value => @order.id %>
          <%= f.submit "更新",class: 'btn btn-success' %>
        <% end %>
      </td>
    </tr>
  </tbody>
  <% end %>
</table>

<div>
  <p>商品合計</p>
  <p>送料</p>
  <p>請求金額合計</p>
</div>
<div>
  <p><%= @total.to_s(:delimited)+"円" %></p>
  <p><%= 800.to_s(:delimited)+"円" %></p>
  <p><%= @order.charge.to_s(:delimited)+"円" %></p>
</div>